<SPConfig xmlns="urn:mace:shibboleth:2.0:native:sp:config"
          xmlns:conf="urn:mace:shibboleth:2.0:native:sp:config"
          xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
          xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
          xmlns:md="urn:oasis:names:tc:SAML:2.0:metadata"
          clockSkew="180">

    <!--
    By default, in-memory StorageService, ReplayCache, ArtifactMap, and SessionCache
    are used. See example-shibboleth2.xml for samples of explicitly configuring them.
    -->

    <!--
    To customize behavior for specific resources on Apache, and to link vhosts or
    resources to ApplicationOverride settings below, use web server options/commands.
    See https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPConfigurationElements for help.

    For examples with the RequestMap XML syntax instead, see the example-shibboleth2.xml
    file, and the https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPRequestMapHowTo topic.
    -->

    <!-- The ApplicationDefaults element is where most of Shibboleth's SAML bits are defined. -->
    <ApplicationDefaults entityID="flw"
                         REMOTE_USER="eppn persistent-id targeted-id"
                         attributePrefix="AJP_">

        <!--
        Controls session lifetimes, address checks, cookie handling, and the protocol handlers.
        You MUST supply an effectively unique handlerURL value for each of your applications.
        The value defaults to /Shibboleth.sso, and should be a relative path, with the SP computing
        a relative value based on the virtual host. Using handlerSSL="true", the default, will force
        the protocol to be https. You should also set cookieProps to "https" for SSL-only sites.
        Note that while we default checkAddress to "false", this has a negative impact on the
        security of your site. Stealing sessions via cookie theft is much easier with this disabled.
        -->
        <Sessions lifetime="28800" timeout="3600" relayState="ss:mem"
                  checkAddress="false" handlerSSL="true" cookieProps="https">

            <!--
            Configures SSO for a default IdP. To allow for >1 IdP, remove
            entityID property and adjust discoveryURL to point to discovery service.
            (Set discoveryProtocol to "WAYF" for legacy Shibboleth WAYF support.)
            You can also override entityID on /Login query string, or in RequestMap/htaccess.
            -->
            <SSO entityID="https://sso-dev.carrefour.com/idp/openam">
                SAML2 SAML1
            </SSO>

            <!-- SAML and local-only logout. -->
            <Logout>SAML2 Local</Logout>

            <!-- Extension service that generates "approximate" metadata based on SP configuration. -->
            <Handler type="MetadataGenerator" Location="/Metadata" signing="false"/>

            <!-- Status reporting service. -->
            <Handler type="Status" Location="/Status" acl="127.0.0.1 ::1"/>

            <!-- Session diagnostic service. -->
            <Handler type="Session" Location="/Session" showAttributeValues="false"/>

            <!-- JSON feed of discovery information. -->
            <Handler type="DiscoveryFeed" Location="/DiscoFeed"/>
        </Sessions>

        <!--
        Allows overriding of error template information/filenames. You can
        also add attributes with values that can be plugged into the templates.
        -->
        <Errors supportContact="thibault.caporal@trinov.com"
                helpLocation="/about.html"
                styleSheet="/shibboleth-sp/main.css"/>

        <!-- Example of remotely supplied batch of signed metadata. -->
        <!--
        <MetadataProvider type="XML" uri="http://federation.org/federation-metadata.xml"
              backingFilePath="federation-metadata.xml" reloadInterval="7200">
            <MetadataFilter type="RequireValidUntil" maxValidityInterval="2419200"/>
            <MetadataFilter type="Signature" certificate="fedsigner.pem"/>
        </MetadataProvider>
        -->

        <!-- Example of locally maintained metadata. -->
        <MetadataProvider type="XML" file="metadata/carrefour-metadata.xml"/>

        <!-- Map to extract attributes from SAML assertions. -->
        <AttributeExtractor type="XML" validate="true" reloadChanges="false" path="attribute-map.xml"/>

        <!-- Use a SAML query if no attributes are supplied during SSO. -->
        <AttributeResolver type="Query" subjectMatch="true"/>

        <!-- Default filtering policy for recognized attributes, lets other data pass. -->
        <AttributeFilter type="XML" validate="true" path="attribute-policy.xml"/>

        <!-- Simple file-based resolver for using a single keypair. -->
        <CredentialResolver type="File" key="sp-key.pem" certificate="sp-cert.pem"/>

        <!--
        The default settings can be overridden by creating ApplicationOverride elements (see
        the https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApplicationOverride topic).
        Resource requests are mapped by web server commands, or the RequestMapper, to an
        applicationId setting.

        Example of a second application (for a second vhost) that has a different entityID.
        Resources on the vhost would map to an applicationId of "admin":
        -->
        <!--
        <ApplicationOverride id="admin" entityID="https://admin.example.org/shibboleth"/>
        -->
    </ApplicationDefaults>

    <!-- Policies that determine how to process and authenticate runtime messages. -->
    <SecurityPolicyProvider type="XML" validate="true" path="security-policy.xml"/>

    <!-- Low-level configuration about protocols and bindings available for use. -->
    <ProtocolProvider type="XML" validate="true" reloadChanges="false" path="protocols.xml"/>

</SPConfig>
        root@serveur-web-flw:/etc/apache2/ssl# ls
        flw-dev.carrefour.com.csr  flw-dev.carrefour.com.key  flw-dev.carrefour.com.pem  organization.crt
        root@serveur-web-flw:/etc/apache2/ssl# ls /etc/shibboleth/
        accessError.html   attribute-policy.xml  discoveryTemplate.html   globalLogout.html  metadataError.html  postTemplate.html    sessionError.html  sp-cert.pem    syslog.logger
        attrChecker.html   bindingTemplate.html  example-metadata.xml     localLogout.html   native.logger       protocols.xml        shibboleth2.xml    sp-key.pem     upgrade.xsl
        attribute-map.xml  console.logger        example-shibboleth2.xml  metadata           partialLogout.html  security-policy.xml  shibd.logger       sslError.html
        root@serveur-web-flw:/etc/apache2/ssl# ls /etc/shibboleth/metadata
        carrefour-metadata.xml
        root@serveur-web-flw:/etc/apache2/ssl# cat /etc/shibboleth/metadata
        metadata/           metadataError.html
        root@serveur-web-flw:/etc/apache2/ssl# cat /etc/shibboleth/metadata/carrefour-metadata.xml
        <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<EntityDescriptor entityID="https://sso-dev.carrefour.com/idp/openam" xmlns="urn:oasis:names:tc:SAML:2.0:metadata">
<IDPSSODescriptor WantAuthnRequestsSigned="false" protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol">
    <KeyDescriptor use="signing">
        <ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
            <ds:X509Data>
                <ds:X509Certificate>
                    MIIDhzCCAm+gAwIBAgIEfITFZzANBgkqhkiG9w0BAQsFADB0MQ8wDQYDVQQGEwZGUkFOQ0UxDDAK
                    BgNVBAgTA0lERjEOMAwGA1UEBxMFTWFzc3kxEjAQBgNVBAoTCUNhcnJlZm91cjEMMAoGA1UECxMD
                    R05UMSEwHwYDVQQDExhvcGVuYW0tZGV2LmNhcnJlZm91ci5jb20wHhcNMTYxMTI4MTU1NTQzWhcN
                    MzYxMTIzMTU1NTQzWjB0MQ8wDQYDVQQGEwZGUkFOQ0UxDDAKBgNVBAgTA0lERjEOMAwGA1UEBxMF
                    TWFzc3kxEjAQBgNVBAoTCUNhcnJlZm91cjEMMAoGA1UECxMDR05UMSEwHwYDVQQDExhvcGVuYW0t
                    ZGV2LmNhcnJlZm91ci5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCInCXKUeeL
                    8knA4H08ADYqY2gJ+OzHyG7D2NZX2ImTGg0bryEbX6uD9nI4d0JlOPdw9eB8TKayQNxZQb5xs3a2
                    fR83cQQwGcJ+ua3GmmRYpjUwn4f8uOnA+OdUlAY1j9eYIJaXL7pUW7kU1f3/WHeKoDcngzl9Mslh
                    aGCa52xLUijFKdM28SY/NLyb1UFDF18UfXNfOA/ioR0FQA/6vH6h2HtEkYb9F9fdMeWHarWp2ima
                    DOtE3fn3+M6Lp/JYLdB3oOT5aAVOPrhZlVupKaLdDrKo74bXuheIRzwKaIWwuoslJ6VJ1R5oQNvy
                    IWcaOGzZgJs7O7Kr0OcRFBwyr0N9AgMBAAGjITAfMB0GA1UdDgQWBBQRCbj3B73vswOKhBG5LayR
                    ncUY9TANBgkqhkiG9w0BAQsFAAOCAQEAYLV+tI2vjV5GsTTHXLn3RUOSbmDv2ZkbU8nnTXXjFDOx
                    /Se+WGOG6+Nh86F3BeuIRpEZG1G3ZJZAvM/ZQBKErcPiD7McPzomLxUIhixf/8CXR6KCjL8Kh9DV
                    +D+n294w9whjM9HBXJJj3yauevUotWYNgXzIxhCqFAJoKTDFgmScF2nOCR+Ua/YYbQl4nw0PFcJD
                    kJz8l+D5TTgi9nK7d2QKuBbrIFWE56RzoKWFx/hcCNFBxfvAf3F9/espmRrE94+7Dkrs37r+3Oi6
                    jdrgnBq7RPqSLh5Ohls0+8OgSahB/x257W9JMRTdWonkOmbPNCo8bnTKUPhUKehAWQsE4A==
                </ds:X509Certificate>
            </ds:X509Data>
        </ds:KeyInfo>
    </KeyDescriptor>
    <ArtifactResolutionService index="0" isDefault="true" Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP" Location="https://sso-dev.carrefour.com/openam/ArtifactResolver/metaAlias/Developpement/idp"/>
    <SingleLogoutService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect" Location="https://sso-dev.carrefour.com/openam/IDPSloRedirect/metaAlias/Developpement/idp" ResponseLocation="https://sso-dev.carrefour.com/openam/IDPSloRedirect/metaAlias/Developpement/idp"/>
    <SingleLogoutService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" Location="https://sso-dev.carrefour.com/openam/IDPSloPOST/metaAlias/Developpement/idp" ResponseLocation="https://sso-dev.carrefour.com/openam/IDPSloPOST/metaAlias/Developpement/idp"/>
    <SingleLogoutService Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP" Location="https://sso-dev.carrefour.com/openam/IDPSloSoap/metaAlias/Developpement/idp"/>
    <ManageNameIDService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect" Location="https://sso-dev.carrefour.com/openam/IDPMniRedirect/metaAlias/Developpement/idp" ResponseLocation="https://sso-dev.carrefour.com/openam/IDPMniRedirect/metaAlias/Developpement/idp"/>
    <ManageNameIDService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" Location="https://sso-dev.carrefour.com/openam/IDPMniPOST/metaAlias/Developpement/idp" ResponseLocation="https://sso-dev.carrefour.com/openam/IDPMniPOST/metaAlias/Developpement/idp"/>
    <ManageNameIDService Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP" Location="https://sso-dev.carrefour.com/openam/IDPMniSoap/metaAlias/Developpement/idp"/>
    <NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:transient</NameIDFormat>
    <NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress</NameIDFormat>
    <NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified</NameIDFormat>
    <NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:WindowsDomainQualifiedName</NameIDFormat>
    <NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:kerberos</NameIDFormat>
    <NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName</NameIDFormat>
    <NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:unspecified</NameIDFormat>
    <NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</NameIDFormat>
    <NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:email</NameIDFormat>
    <NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:gntguid</NameIDFormat>
    <SingleSignOnService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect" Location="https://sso-dev.carrefour.com/openam/SSORedirect/metaAlias/Developpement/idp"/>
    <SingleSignOnService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" Location="https://sso-dev.carrefour.com/openam/SSOPOST/metaAlias/Developpement/idp"/>
    <SingleSignOnService Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP" Location="https://sso-dev.carrefour.com/openam/SSOSoap/metaAlias/Developpement/idp"/>
    <NameIDMappingService Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP" Location="https://sso-dev.carrefour.com/openam/NIMSoap/metaAlias/Developpement/idp"/>
    <AssertionIDRequestService Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP" Location="https://openam-dev-1.carrefour.com:8443/openam/AIDReqSoap/IDPRole/metaAlias/Developpement/idp"/>
    <AssertionIDRequestService Binding="urn:oasis:names:tc:SAML:2.0:bindings:URI" Location="https://openam-dev-1.carrefour.com:8443/openam/AIDReqUri/IDPRole/metaAlias/Developpement/idp"/>
</IDPSSODescriptor>
</EntityDescriptor>